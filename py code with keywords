import speech_recognition as sr
from googletrans import Translator

def recognize_speech(language_code='en-US', timeout=60, phrase_time_limit=60):
    recognizer = sr.Recognizer()
    microphone = sr.Microphone()

    with microphone as source:
        print("Adjusting for ambient noise... Please wait.")
        recognizer.adjust_for_ambient_noise(source)
        print("Listening...")
        audio = recognizer.listen(source, timeout=timeout, phrase_time_limit=phrase_time_limit)

    try:
        print("Recognizing...")
        text = recognizer.recognize_google(audio, language=language_code)
        return text
    except sr.UnknownValueError:
        return "Sorry, I did not understand that."
    except sr.RequestError:
        return "Sorry, I am unable to access the speech recognition service."

def translate_text(text, target_language):
    translator = Translator()
    translated = translator.translate(text, dest=target_language)
    return translated.text

def categorize_text(text):
    categories = {
        'name': ['your name'],
        'contact': ['phone no'],
        'email': ['gmail', 'email'],
        'objective': ['objective'],
        'education': ['education', 'degree', 'university', 'college', 'school'],
        'experience': ['internship', 'training', 'work', 'experience', 'job'],
        'accomplishments': ['award', 'achievement', 'certificate', 'competition', 'accomplishment', 'project'],
        'skills': ['python', 'java', 'c', 'c++', 'django'],
        'references': ['references']
    }
    
    categorized_data = {
        'name': [],
        'contact': [],
        'email': [],
        'objective': [],
        'education': [],
        'experience': [],
        'accomplishments': [],
        'skills': [],
        'references': []
    }
    
    for line in text.split('.'):
        for category, keywords in categories.items():
            if any(keyword in line.lower() for keyword in keywords):
                categorized_data[category].append(line.strip())
                break

    return categorized_data

if _name_ == "_main_":
    language_options = {
        'hindi': 'hi-IN',
        'telugu': 'te-IN',
        'tamil': 'ta-IN'
    }

    print("Please say the language you want to use: Hindi, Telugu, or Tamil.")
    recognized_text = recognize_speech('en-US')

    print(f"You said: {recognized_text}")

    chosen_language = recognized_text.lower().strip()

    if chosen_language in language_options:
        language_code = language_options[chosen_language]
        print(f"Selected language: {language_code}")
        print("You can start speaking your entire resume content now...")
        recognized_text = recognize_speech(language_code)
        print("Recognized Speech:", recognized_text)

        if recognized_text not in ["Sorry, I did not understand that.", "Sorry, I am unable to access the speech recognition service."]:
            categorized_data = categorize_text(recognized_text)

            print("\nCategorized Data:")
            for section, content in categorized_data.items():
                print(f"\n{section.capitalize()} Section:")
                print("\n".join(content))

            print("\nPlease say the language you want to translate to: Hindi, Telugu, Tamil, English")
            target_language_choice = recognize_speech('en-US').lower().strip()

            translation_options = {
                'hindi': 'hi',
                'telugu': 'te',
                'tamil': 'ta',
                'english': 'en'
            }

            if target_language_choice in translation_options:
                target_language_code = translation_options[target_language_choice]

                translated_sections = {}
                for section, content in categorized_data.items():
                    translated_sections[section] = [translate_text(line, target_language_code) for line in content]

                print("\nTranslated Sections:")
                for section, content in translated_sections.items():
                    print(f"\n{section.capitalize()} Section:")
                    print("\n".join(content))
            else:
                print("Invalid choice. Please restart and choose a valid translation language.")
    else:
        print("Invalid choice. Please restart and choose a valid language.")
